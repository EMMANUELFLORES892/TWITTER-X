/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package com.mycompany.proyectox;
import java.awt.Color;
import static java.awt.Color.gray;
import static java.awt.Color.white;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import javax.swing.JFrame;
import javax.swing.JTextField;

/**
 *
 * @author PC
 */
public class IniciaSesion extends javax.swing.JFrame {

    /**
     * Creates new form IniciaSesion
     */
    public IniciaSesion() {
        initComponents();
        Imagenes Img = new Imagenes();
        
        getContentPane().setBackground(Color.WHITE);
        
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setResizable(false);
        
        this.setLocationRelativeTo(this);
        this.error1.setVisible(false);
        this.error2.setVisible(false);
        
        Img.SetImageLabel(Logo,"src/main/java/Imagenes_Login/X-Logo.png", 80, 50);
        BotonRedondo.hacerRedondeado(Siguiente, 30,white,gray);
//----------------------------------------------------------------------------------------------------------------------------------------------
        
    
    
    
    
    
    
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        Logo = new javax.swing.JLabel();
        Usuario = new javax.swing.JTextField();
        contras = new javax.swing.JPasswordField();
        Registro = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jSeparator2 = new javax.swing.JSeparator();
        Siguiente = new javax.swing.JButton();
        error1 = new javax.swing.JLabel();
        error2 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        Logo.setText("Logo mini");
        Logo.setPreferredSize(new java.awt.Dimension(70, 70));

        Usuario.setText("Nombre De Usuario O Correo Electronico");
        Usuario.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                UsuarioActionPerformed(evt);
            }
        });

        contras.setText("Contraseña");
        contras.setToolTipText("");
        contras.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                contrasActionPerformed(evt);
            }
        });

        Registro.setText("<html>\n¿No tienes una cuenta?  <font color= \"rgb(51, 153, 255)\">Regístrate</font>");
        Registro.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                RegistroMouseClicked(evt);
            }
        });

        jLabel2.setFont(new java.awt.Font("Arial Black", 0, 36)); // NOI18N
        jLabel2.setText("Inicia sesión en X");

        Siguiente.setFont(new java.awt.Font("Arial Rounded MT Bold", 1, 14)); // NOI18N
        Siguiente.setForeground(new java.awt.Color(102, 102, 102));
        Siguiente.setText("Siguiente");
        Siguiente.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                SiguienteActionPerformed(evt);
            }
        });

        error1.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        error1.setForeground(new java.awt.Color(204, 0, 51));
        error1.setText("Nombre De Usuario o Correo Incorrectos");

        error2.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        error2.setForeground(new java.awt.Color(204, 0, 51));
        error2.setText("Contraseña Incorrecta");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(157, 157, 157)
                        .addComponent(Logo, javax.swing.GroupLayout.PREFERRED_SIZE, 85, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(21, 21, 21)
                        .addComponent(jLabel2))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(42, 42, 42)
                        .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 308, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(97, 97, 97)
                        .addComponent(Registro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(56, 56, 56)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(Usuario, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(contras, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGroup(layout.createSequentialGroup()
                                    .addGap(19, 19, 19)
                                    .addComponent(error2))
                                .addComponent(Siguiente, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(76, 76, 76)
                        .addComponent(error1)))
                .addContainerGap(29, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(Logo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel2)
                .addGap(18, 18, 18)
                .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 18, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(Usuario, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(1, 1, 1)
                .addComponent(error1)
                .addGap(18, 18, 18)
                .addComponent(contras, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(error2)
                .addGap(18, 18, 18)
                .addComponent(Siguiente, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 44, Short.MAX_VALUE)
                .addComponent(Registro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(23, 23, 23))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void UsuarioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_UsuarioActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_UsuarioActionPerformed

    private void contrasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_contrasActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_contrasActionPerformed

    private void SiguienteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_SiguienteActionPerformed
        // TODO add your handling code here:
        // Cerrar el JFrame actual
    /*this.dispose();
    
    // Crear una nueva instancia del JFrame que deseas abrir
    BasePagina frame = new BasePagina();
    frame.setVisible(true);*/
    
    // Obtener el texto ingresado en el JTextField
        String textoIngresado = Usuario.getText();
        this.error1.setVisible(false);
        this.error2.setVisible(false);
        // Obtener el texto ingresado en el JPasswordField (asumiendo que se llama passwordField)
        char[] contrasenaIngresada = contras.getPassword();
        String contrasena = new String(contrasenaIngresada); // Convertir el arreglo de caracteres en una cadena
        
        // Realizar la conexión a la base de datos
        try (Connection conn = DriverManager.getConnection("jdbc:ucanaccess://X.accdb")) {
            // Crear la consulta SQL para seleccionar la columna deseada
            String sql = "SELECT user_handle, email FROM usuarios";
            
            // Ejecutar la consulta
            boolean encontrado = false; // Bandera para indicar si se encontró una coincidencia
            try (Statement stmt = conn.createStatement();
                 ResultSet rs = stmt.executeQuery(sql)) {
                // Iterar sobre los resultados
                while (rs.next()) {
                    // Obtener el valor de la columna en la fila actual
                    String valorBaseDatos = rs.getString("user_handle");
                    String valorBaseDatos1 = rs.getString("email");
                    
                    // Comparar el valor de la base de datos con el texto ingresado
                    if (textoIngresado.equals(valorBaseDatos) || textoIngresado.equals(valorBaseDatos1)) {
                        // El texto ingresado es igual a un valor en la base de datos
                        System.out.println("El texto ingresado es igual a un valor en la base de datos.");
                        // Realizar alguna acción adicional si es necesario
                        encontrado = true;

                        break; // Salir del bucle si se encuentra una coincidencia
                    }
                }
            }
//HASTA ESTA PARTE SE VERIFICA QUE EL NOMBRE DE USUARIO INGRESADO ESTE DENTRO DE LA BASE DE DATOS------------------------------------------------------
            // Verificar si se encontró una coincidencia en el JTextField
            if (encontrado) {
                // Ahora, verifica el dato ingresado en el JPasswordField
                String sqlContrasena = "SELECT contra FROM usuarios WHERE user_handle = ? OR email = ?";
                try (PreparedStatement pstmt = conn.prepareStatement(sqlContrasena)) {
                    pstmt.setString(1, textoIngresado);
                    pstmt.setString(2, textoIngresado);
                    ResultSet rsContrasena = pstmt.executeQuery();
                    if (rsContrasena.next()) {
                        String contrasenaBaseDatos = rsContrasena.getString("contra");
                        contrasenaBaseDatos = contrasenaBaseDatos.replace("<div>", "").replace("</div>", "");
                        if (contrasena.equals(contrasenaBaseDatos)) {
                            // La contraseña ingresada coincide con la contraseña en la base de datos
                            System.out.println("La contraseña ingresada coincide con la contraseña en la base de datos.");
                            this.dispose();
                            BasePagina frame = new BasePagina();
                            frame.setVisible(true);
                            
                            // Realizar alguna acción adicional si es necesario
                        } else {
                            // La contraseña ingresada no coincide con la contraseña en la base de datos
                            System.out.println("La contraseña ingresada no coincide con la contraseña en la base de datos.");
                            this.error2.setVisible(true);
                            System.out.println(contrasenaIngresada);//para comprobar que dato retiene
                            System.out.println(contrasenaBaseDatos);
                        }
                    } else {
                        // No se encontró el usuario en la base de datos
                        System.out.println("El usuario no existe en la base de datos.");
                        // Realizar alguna acción adicional si es necesario
                    }
                }
            } else {
                // El texto ingresado en el JTextField no coincide con ningún valor en ninguna columna
                System.out.println("El texto ingresado en el JTextField no coincide con ningún valor en ninguna columna.");
                this.error1.setVisible(true);
                this.error2.setVisible(true);
                // Realizar alguna acción adicional si es necesario
            }
        } catch (SQLException ex) {
            ex.printStackTrace();
        }
    
    
    
    
    
    
    
    
    
    }//GEN-LAST:event_SiguienteActionPerformed

    private void RegistroMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_RegistroMouseClicked
        // TODO add your handling code here:
        this.dispose();
    
    // Crear una nueva instancia del JFrame que deseas abrir
    Registro frame = new Registro();
    frame.setVisible(true);
    }//GEN-LAST:event_RegistroMouseClicked

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(IniciaSesion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(IniciaSesion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(IniciaSesion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(IniciaSesion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new IniciaSesion().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel Logo;
    private javax.swing.JLabel Registro;
    private javax.swing.JButton Siguiente;
    private javax.swing.JTextField Usuario;
    private javax.swing.JPasswordField contras;
    private javax.swing.JLabel error1;
    private javax.swing.JLabel error2;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JSeparator jSeparator2;
    // End of variables declaration//GEN-END:variables
}
